-- ‡πÇ‡∏´‡∏•‡∏î WindUI
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Camera = workspace.CurrentCamera

local LocalPlayer = Players.LocalPlayer
local Window = WindUI:CreateWindow({
    Title = "Yomo HUB üßë‚Äçüíª | v0.1 | ",
    Icon = "menu",
    Author = "https://discord.gg/xWW3jhKM",
    Folder = "KungHubkFolder",
    Size = UDim2.fromOffset(400, 200),
    Theme = "Dark",
    Transparent = true,
    Resizable = true,
})

---------------------------------
-- Silent Aim Only -----
---------------------------------
local Tab = Window:Tab({Title = "Silent Aim", Icon = "crosshair"})
local SilentAimEnabled = false
local FOVRadius = 120
local CurrentTarget = nil

local SilentFOVCircle = Drawing.new("Circle")
SilentFOVCircle.Color = Color3.fromRGB(255, 255, 0)
SilentFOVCircle.Thickness = 1
SilentFOVCircle.NumSides = 64
SilentFOVCircle.Filled = false
SilentFOVCircle.Transparency = 1
SilentFOVCircle.Radius = FOVRadius
SilentFOVCircle.Visible = false

local Tracer = Drawing.new("Line")
Tracer.Thickness = 1
Tracer.Color = Color3.fromRGB(0, 255, 255)
Tracer.Transparency = 1
Tracer.Visible = false

local function getClosestTarget()
    local closest, shortestDistance = nil, math.huge
    local center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            if not humanoid or humanoid.Health <= 0 then continue end
            local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
            if onScreen then
                local screenPos = Vector2.new(pos.X, pos.Y)
                if (screenPos - center).Magnitude <= FOVRadius then
                    local distance3D = (head.Position - (LocalPlayer.Character:FindFirstChild("Head") or head).Position).Magnitude
                    if distance3D < shortestDistance then
                        shortestDistance = distance3D
                        closest = player
                    end
                end
            end
        end
    end
    return closest
end

RunService.RenderStepped:Connect(function()
    SilentFOVCircle.Visible = SilentAimEnabled
    SilentFOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    if SilentAimEnabled then
        CurrentTarget = getClosestTarget()
    else
        CurrentTarget = nil
    end

    if CurrentTarget and CurrentTarget.Character then
        local head = CurrentTarget.Character:FindFirstChild("Head")
        if head then
            local a, ascr = Camera:WorldToViewportPoint((LocalPlayer.Character:FindFirstChild("Head") or head).Position)
            local b, bscr = Camera:WorldToViewportPoint(head.Position)
            if ascr and bscr then
                Tracer.From = Vector2.new(a.X, a.Y)
                Tracer.To = Vector2.new(b.X, b.Y)
                Tracer.Visible = true
            else
                Tracer.Visible = false
            end
        end
    else
        Tracer.Visible = false
    end
end)

Tab:Toggle({
    Title = "Silent Aim",
    Default = false,
    Callback = function(v) SilentAimEnabled = v end
})

Tab:Slider({
    Title = "FOV:",
    Step = 1,
    Value = {Min = 20, Max = 500, Default = 120},
    Callback = function(v) FOVRadius = v end
})

-- ESPBox only
local Tab_ESPBOX = Window:Tab({Title = "ESPBOX", Icon = "eye"})
local espboxEnabled = false

Tab_ESPBOX:Toggle({
    Title = "ESP Box",
    Default = false,
    Callback = function(v) espboxEnabled = v end
})

local espPlayers = {}

local function createESPBOX(player)
    local lines = {
        top = Drawing.new("Line"),
        bottom = Drawing.new("Line"),
        left = Drawing.new("Line"),
        right = Drawing.new("Line")
    }
    for _, line in pairs(lines) do
        line.Color = Color3.fromRGB(0,255,0)
        line.Thickness = 2
        line.Visible = false
    end
    local drawings = {lines.top, lines.bottom, lines.left, lines.right}
    local conn = RunService.RenderStepped:Connect(function()
        if not player.Character or not player.Character:FindFirstChild("Head") or not player.Character:FindFirstChild("HumanoidRootPart") then
            for _, l in pairs(lines) do l.Visible = false end
            return
        end
        local head = player.Character.Head
        local hrp = player.Character.HumanoidRootPart
        local topWorld = head.Position + Vector3.new(0,1,0)
        local bottomWorld = hrp.Position - Vector3.new(0,3.5,0)
        local top, onTop = Camera:WorldToViewportPoint(topWorld)
        local bottom, onBottom = Camera:WorldToViewportPoint(bottomWorld)
        if espboxEnabled and onTop and onBottom and top.Z > 0 then
            local height = math.abs(top.Y - bottom.Y) * 1.2
            local width = height/1.5
            local x = top.X - width/2
            local y = top.Y - height*0.1
            local tl = Vector2.new(x,y)
            local tr = Vector2.new(x+width,y)
            local bl = Vector2.new(x,y+height)
            local br = Vector2.new(x+width,y+height)
            lines.top.From = tl; lines.top.To = tr
            lines.bottom.From = bl; lines.bottom.To = br
            lines.left.From = tl; lines.left.To = bl
            lines.right.From = tr; lines.right.To = br
            for _, l in pairs(lines) do l.Visible = true end
        else
            for _, l in pairs(lines) do l.Visible = false end
        end
    end)
    espPlayers[player] = {conn = conn, drawings = drawings}
end

local function loadESPBOX()
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then createESPBOX(p) end
    end
    Players.PlayerAdded:Connect(function(p)
        if p ~= LocalPlayer then
            p.CharacterAdded:Connect(function()
                task.wait(.2)
                createESPBOX(p)
            end)
        end
    end)
    Players.PlayerRemoving:Connect(function(p)
        if espPlayers[p] then
            espPlayers[p].conn:Disconnect()
            for _, d in pairs(espPlayers[p].drawings) do d:Remove() end
            espPlayers[p] = nil
        end
    end)
end
loadESPBOX()
